# What covered in notes
- multi window handle
- wait mechansim (global, per page, and per locator)

## 1. Multiple Window / Tab Handling using `BrowserContext.pages()`

### 1.1 Concept
In Playwright, **every new tab or window belongs to a BrowserContext**.

Playwright does NOT switch windows like Selenium. Instead, it gives you **Page objects**.

---

### 1.2 Practical Code

```ts
const browser = await chromium.launch({ channel: 'chrome', headless: false });
const context = await browser.newContext();
const page = await context.newPage();

await page.goto('https://www.orangehrm.com/en/contact-sales/');

const mainPageTitle = await page.title();

await page.locator("//a[contains(@href,'linkedin')]").click();
await page.locator("//a[contains(@href,'x.com')]").click();
await page.locator("//a[contains(@href,'facebook.com')]").click();

await page.waitForTimeout(3000);

const allPages = context.pages();
console.log('Total windows:', allPages.length);

for (const pg of allPages) {
  const title = await pg.title();
  console.log(title);

  if (title !== mainPageTitle) {
    await pg.close();
  }
}

console.log('Main page title:', await page.title());
```

---

### 1.3 Output
- Multiple tabs open
- Titles printed in console
- Child windows closed
- Main page remains active

---

### 1.4 Best Practices
- Use `BrowserContext.pages()` instead of window handles
- Identify pages using **title or URL**
- Close unnecessary pages to avoid memory issues

---

## 2. Wait Mechanisms in Playwright (Most Important Topic)

### 2.1 Types of Waits

| Type | Scope | Example |
|---|---|---|
| Global wait | Whole project | playwright.config.ts |
| Page default wait | Single page | page.setDefaultTimeout() |
| Action wait | Single action | click({timeout}) |
| Auto-wait | Built-in | locator.click() |
| Explicit wait | Manual | locator.waitFor() |

---

## 3. Global Timeout (Config Level)

```ts
use: {
  actionTimeout: 5000,
}
```

### Meaning
- Applies to all tests
- Lowest priority

---

## 4. Page-Level Default Timeout

```ts
page.setDefaultTimeout(10000);
```

### Meaning
- Applies only to this page
- Overrides global timeout

---

## 5. Action-Level Timeout (Highest Priority)

```ts
const firstname = page.locator('#input-firstname11');
await firstname.click({ timeout: 5000 });
```

### Important Concept
- Locator creation NEVER throws error
- Error happens only when action is performed

---

## 6. Auto-Wait vs Promise (Core Concept)

### Auto-Wait
Playwright auto-waits **only for user actions**.

### Auto-Wait Applies To
- click()
- fill()
- type()
- press()
- hover()
- check()

### Auto-Wait Internally Checks
1. Element attached to DOM
2. Element visible
3. Element stable
4. Element enabled
5. Element not blocked
6. Element in viewport

---

### Promise Only (No Auto-Wait)

| Method | Reason |
|---|---|
| textContent() | Read only |
| innerText() | Read only |
| count() | Read only |
| isVisible() | State check |
| scrollIntoViewIfNeeded() | Utility |
| page.evaluate() | JS execution |

---

## 7. Explicit Waits (Manual Control)

### Locator-based Wait (Recommended)

```ts
await firstname.waitFor({ state: 'visible', timeout: 5000 });
await firstname.fill('Testing');
```

---

### Page-based Wait (Legacy)

```ts
(await page.waitForSelector('#input-firstname')).fill('Testing');
```

⚠ Not recommended for modern Playwright usage.

---

## 8. Page Load State Waits

```ts
await page.waitForLoadState('load');
await page.waitForLoadState('domcontentloaded');
await page.waitForLoadState('networkidle');
```

### Meaning
- load → page fully loaded
- domcontentloaded → DOM ready
- networkidle → APIs finished

---

## 9. Assertions (`expect`) – Auto-Wait via Polling

```ts
await expect(page.locator('#successmesg')).toBeVisible();
```

### Important
- `expect(locator)` has auto-wait
- `expect(value)` does NOT

---

## 10. Video Recording – Context Level

### Manual Context Video Recording

```ts
const context = await browser.newContext({
  recordVideo: {
    dir: './videos',
    size: { width: 800, height: 600 }
  }
});

const page = await context.newPage();
await page.goto('https://selectorshub.com/iframe-scenario/');
```

---

### Config-Level Video Options

```ts
use: {
  video: 'retain-on-failure'
}
```

| Option | Meaning |
|---|---|
| off | No video |
| on | All tests |
| retain-on-failure | Only failed tests |
| on-first-retry | First retry only |

---

## 11. Screenshot vs Video (Important Difference)

| Feature | Screenshot | Video |
|---|---|---|
| Can call manually | Yes | No |
| Needs context setup | No | Yes |
| Config disables manual? | No | No |

---

## 12. Best Practices Summary (For Students)

- Prefer locator actions over page mouse actions
- Rely on auto-wait instead of hard waits
- Use `expect(locator)` for assertions
- Handle multiple windows via context.pages()
- Enable video only for failures or retries
- Avoid heavy logic in event listeners

---

## 13. Interview One-Liners

- Playwright uses Page objects instead of window handles
- Auto-wait applies only to user actions
- Promise does not mean auto-wait
- Video recording is decided at context creation time

---


